SelitÃ¤n tÃ¤ssÃ¤ nyt vielÃ¤ mitÃ¤ olin itse ajatellut, jos onnistun selittÃ¤mÃ¤Ã¤n. 
1. base versioista olisi kloonattu kÃ¤yttÃ¶versiot json-tiedostoille, eli base tiedosto on taustamalli josta rakenne luodaan ja sitten luotua rakennetta kÃ¤ytetÃ¤Ã¤n ohjelmassa. 
2. lista alunperin suunnittelemista tiedostoista
"files": {
        "questions.json": ",
        "new_questions.json",
        "active_questions.json":,
        "ipfs_questions.json":,
        "parties.json":,
        "party_profiles.json"
        "candidates.json": ,
        "candidate_profiles.json":,
        "meta.json": 

jossa kysymykset lisÃ¤tÃ¤Ã¤n new_questions.json, niin ettÃ¤ tiedosta luodaan vÃ¤liaikainen tmp_new_questions.json, johon lÃ¤hetetyt kysymykset tallennetaan. TÃ¤stÃ¤ kysymykset synkronoidaan -> questions.json ja questions.json synkronoidaan <--> ipfs_questions.json synkronoidaan <--> ipfs-verkko

# VaalikonejÃ¤rjestelmÃ¤ - Tekninen Kuvaus

## ğŸ¯ JÃ¤rjestelmÃ¤n Ydinkonsepti

**Hajautettu, yhteisÃ¶ohjattu vaalikone joka kÃ¤yttÃ¤Ã¤ ELO-luokitusjÃ¤rjestelmÃ¤Ã¤ kysymysten priorisointiin ja automoderaatioon.**

## ğŸ—ï¸ Arkkitehtuuri

### Tiedostopohjainen Data Pipeline
```
Base Templates â†’ Runtime Instances â†’ IPFS Synkronointi
    â†“               â†“                     â†“
*.base.json     *.json (kÃ¤yttÃ¶)      IPFS Verkko
```

### Modulaariset Komponentit
1. **Metadata Manager** - Koneiden identiteetit & allekirjoitukset
2. **Installation Engine** - Vaalien asennus & konfiguraatio
3. **Question Pipeline** - Kysymysten elinkaari
4. **IPFS Sync Engine** - Hajautettu datajako
5. **Candidate Manager** - Ehdokkaat & vastaukset

## ğŸ”„ Kysymysten Elinkaari

```
Uusi Kysymys
    â†“
tmp_new_questions.json (vÃ¤liaikainen)
    â†“  
new_questions.json (odotusaika)
    â†“
questions.json (pÃ¤Ã¤kanta)
    â†“
ipfs_questions.json (paikallinen IPFS-mirror)
    â†“
IPFS Verkko (hajautettu jakelu)
```

## ğŸ² ELO-Luokitusmekanismi

### Kaksitasoinen Rating-jÃ¤rjestelmÃ¤
```python
current_rating = 1000 + comparison_delta + vote_delta
```

**comparison_delta** (-900 max):
- Perinteinen ELO pareittaisissa vertailuissa
- Laadullinen feedback
- Lasketaan: `k_factor * (actual - expected)`

**vote_delta** (-1000 max):
- Yksinkertainen Â±1 per Ã¤Ã¤ni
- MÃ¤Ã¤rÃ¤llinen suosio
- Suora demokratia

### Automaattinen Moderaatio
```python
if (current_rating <= 0 and 
    comparison_delta < 0 and 
    vote_delta < 0):
    BLOCK_QUESTION
```
**EstÃ¤Ã¤:** 
- PelkÃ¤t bot-vertailut (max -900)
- PelkÃ¤t bot-Ã¤Ã¤net (vaatii myÃ¶s negatiivisen comparison_delta:n)
- Vaatii yhteisÃ¶n konsensuksen molemmilla mekanismeilla

## ğŸŒ IPFS Integraatio

### Synkronointitilat
1. **Mock-only** - Testaus (nykyinen)
2. **Hybrid** - Molemmat (siirtymÃ¤)
3. **Real-only** - Tuotanto

### Data Flow
```
Paikallinen Kone â†’ Mock-IPFS â†’ Real-IPFS
      â†“                â†“           â†“
  JSON-tiedot     Testidata   Hajautettu
                                verkko
```

## ğŸ’» Koneiden Hallinta

### Master-TyÃ¶asema -malli
- **Master-kone**: EnsimmÃ¤inen asennus, luo vaalirekisterin
- **TyÃ¶asemat**: LiittyvÃ¤t olemassa olevaan vaaliin
- **YksilÃ¶lliset machine_id:t** - EstÃ¤Ã¤ konfliktit
- **Vaalikohtaiset allekirjoitukset** - Varmistaa integriteetin

## ğŸ“Š Data Model

### Kysymysrakenne
```json
{
  "local_id": "uuid",
  "ipfs_cid": "Qm...",
  "source": "local|ipfs_imported",
  "content": {
    "category": {"fi", "en", "sv"},
    "question": {"fi", "en", "sv"},
    "tags": [],
    "scale": {"min": -5, "max": 5}
  },
  "elo_rating": {
    "base_rating": 1000,
    "comparison_delta": 0,
    "vote_delta": 0,
    "current_rating": 1000
  }
}
```

### Ehdokasrakenne
```json
{
  "candidate_id": "uuid",
  "answers": [
    {
      "question_id": "uuid",
      "answer_value": -5 to 5,
      "explanation": {"fi", "en", "sv"},
      "confidence": 1-5
    }
  ]
}
```

## ğŸ” Tietoturva & Eheys

### System Chain - Muutoshistoria
- Kaikki muutokset lokitetaan `system_chain.json`:Ã¤Ã¤n
- Hash-pohjainen eheystarkistus
- Palautumismekanismi vikatilanteisiin

### Konfliktien Hallinta
1. **Timestamp-pohjainen** - Uudempi voittaa
2. **Manual intervention** - Admin-pÃ¤Ã¤tÃ¶s
3. **Community voting** - YhteisÃ¶ratkaisu

## ğŸš€ KÃ¤yttÃ¶Ã¶notto

### Asennusprosessi
```bash
# 1. Luo konfiguraatio
python create_install_config.py

# 2. Asenna master-kone
python install.py --config-file=config.json --election-id=vaali_2024 --first-install

# 3. LisÃ¤Ã¤ tyÃ¶asemia
python install.py --config-file=config.json --election-id=vaali_2024

# 4. Hallinnoi kysymyksiÃ¤
python manage_questions.py --add --category "Aihe" --question "Kysymys?"
```

### Testaus & Kehitys
```bash
# Mock-IPFS testaus
python ipfs_sync_manager.py status
python simple_sync.py --sync

# Data-eheyden tarkistus
python install.py --verify --election-id=vaali_2024
```

## ğŸ¯ YksilÃ¶lliset Ominaisuudet

### 1. **Ã„lykÃ¤s Moderaatio**
- ELO-pohjainen autoblokkaus
- EstÃ¤Ã¤ manipulation molemmilta tahoilta
- YhteisÃ¶n konsensus vaadittu

### 2. **Hajautettu Arkkitehtuuri**
- Ei single point of failure
- IPFS varmistaa datan saatavuuden
- Monen koneen tuki samalle vaalille

### 3. **Kaksikielinen KÃ¤yttÃ¶liittymÃ¤**
- Suora komentorivityÃ¶kalu
- Graafinen kÃ¤yttÃ¶liittymÃ¤ (tuleva)
- Monikielisyys sisÃ¤Ã¤nrakennettuna

### 4. **Laajennettavuus**
- Modulaarinen rakenne
- Helppo lisÃ¤tÃ¤ uusia vaalityyppejÃ¤
- Plugin-arkkitehtuuri (tuleva)

## ğŸ”® Tulevat Kehityssuunnat

### Lyhytaikaiset
- [ ] Graafinen kÃ¤yttÃ¶liittymÃ¤
- [ ] Ehdokkaiden hallintatyÃ¶kalu
- [ ] Reaaliaikainen synkronointi
- [ ] Konfliktien hallintatyÃ¶kalu

### PitkÃ¤aikaiset
- [ ] Mobile-sovellus
- [ ] AI-pohjainen kysymysten generointi
- [ ] Blockchain-integrointi
- [ ] KansainvÃ¤linen skaalaus

## ğŸ’¡ Ydinajatus

**"Demokratia koodiksi - yhteisÃ¶ luo, Ã¤Ã¤nestÃ¤Ã¤ ja moderoi kysymyksiÃ¤ hajautetusti, kun ELO-luokitus varmistaa laadun ja estÃ¤Ã¤ vÃ¤Ã¤rinkÃ¤ytÃ¶t."**

TÃ¤mÃ¤ jÃ¤rjestelmÃ¤ yhdistÃ¤Ã¤:
- **YhteisÃ¶demokratian** (Ã¤Ã¤nestys & vertailu)
- **Teknisen robustiuden** (hajautus & eheys)
- **KÃ¤ytettÃ¤vyyden** (yksinkertaiset tyÃ¶kalut)
- **Laajennettavuuden** (modulaarisuus)

---

**KÃ¤ynnistÃ¤ uusi keskustelu aiheesta:** "Miten parantaisit tÃ¤tÃ¤ arkkitehtuuria?" tai "MitÃ¤ ominaisuuksia nÃ¤et tÃ¤rkeimpinÃ¤ vaalikoneelle?"

okei kaikki json rakenteen kohdat ovat ainakin tÃ¤llÃ¤ hetkellÃ¤ sielÃ¤, mutta base tiedostoissa ei pitÃ¤isi olla esimerkki dataa noin paljoa, vain selitys mitÃ¤ kenttÃ¤Ã¤n kirjoitetaan, jotkin oletetut config numeeriset arvot on hyvÃ¤ olla niissÃ¤.

esimerkki base tiedostosta:
{
  "metadata": {
    "version": "2.0.0",
    "created": "2025-01-15T10:00:00Z",
    "last_updated": "2025-01-15T10:00:00Z",
    "election_id": "{{ELECTION_ID}}",
    "description": {
      "fi": "Kysymysten perusrakenteet",
      "en": "Basic question structures",
      "sv": "GrundlÃ¤ggande frÃ¥gestrukturer"
    }
  },
  "questions": [
    {
      "local_id": "{{QUESTION_ID}}",
      "ipfs_cid": "{{IPFS_CID}}",
      "source": "local",
      "content": {
        "category": {
          "fi": "{{FI_CATEGORY}}",
          "en": "{{EN_CATEGORY}}",
          "sv": "{{SV_CATEGORY}}"
        },
        "question": {
          "fi": "{{FI_QUESTION}}",
          "en": "{{EN_QUESTION}}",
          "sv": "{{SV_QUESTION}}"
        },
        "tags": ["{{TAG1}}", "{{TAG2}}"],
        "scale": {
          "min": -5,
          "max": 5,
          "labels": {
            "fi": {
              "min": "TÃ¤ysin eri mieltÃ¤",
              "neutral": "Neutraali",
              "max": "TÃ¤ysin samaa mieltÃ¤"
            },
            "en": {
              "min": "Strongly disagree",
              "neutral": "Neutral",
              "max": "Strongly agree"
            },
            "sv": {
              "min": "Helt avig",
              "neutral": "Neutral",
              "max": "Helt enig"
            }
          }
        }
      },
      "elo_rating": {
        "base_rating": 1000,
        "current_rating": 1000,
        "comparison_delta": 0,
        "vote_delta": 0,
        "total_comparisons": 0,
        "total_votes": 0,
        "up_votes": 0,
        "down_votes": 0
      },
      "timestamps": {
        "created_local": "{{TIMESTAMP}}",
        "modified_local": "{{TIMESTAMP}}"
      }
    }
  ]
}

*ehdokasprofiilissa pitÃ¤isi myÃ¶s muuten olla paikka perusteluille, eli jokaisen kysymyksen id:n mukaan vastaava perustelu kenttÃ¤
*Ehdokkaiden ja puolueiden vastauksien oikeallisuus ja vahvistettavuus on silti tÃ¤rkeÃ¤ luotettavuuden kannalta.
*tÃ¤mÃ¤ jÃ¤rjeslmÃ¤ on kuitenkin vain parhaan ehdokkaan lÃ¶ytÃ¤miseksi.
*elections_list.json:ssa pitÃ¤isi olla kohta jossa on cid-osoite vaalienmukaiselle install_config.json tiedostolle
*tehdÃ¤Ã¤n listaus mitÃ¤ moduuleja mikÃ¤kin ohjelma kÃ¤yttÃ¤Ã¤
*tarvitaan active_questions.base.json, josta generoidaan active_questions.json. TÃ¤hÃ¤n tiedostoon synkronoidaan korkeimman elo luokituksen kysymykset, kun kysymysten    lÃ¤hettÃ¤minen on lukittu, jos joku ei lukitse vaaleja, niin tÃ¤mÃ¤ jÃ¤rjestelmÃ¤ kÃ¤yttÃ¤Ã¤ koko kysymyslistaa vaalikoneessa.
*varsinainen vaalikone tuossa vielÃ¤ puuttuu, missÃ¤ kÃ¤yttÃ¤jÃ¤ vertaa vastauksiansa ehdokkaiden vastauksiin ja laittaa ehdokkaat paremmuusjÃ¤rjestykseen. Toisaalta tÃ¤mÃ¤ on todennÃ¤kÃ¶isemmin gui tyylinen syvellus
*system chainin pÃ¤ivityksen pitÃ¤isi varmaankin olla moduuli, jota jokainen ohjelma kutsuu lopussa.

