# Koodin Yleiskuva - ti 11.11.2025 05.05.44 +0200
## src/managers/question_manager.py
```python
from pathlib import Path
from typing import Dict, List
from src.core.file_utils import read_json_file, write_json_file

class QuestionManager:
    def __init__(self, election_id: str, data_dir: str = "data/runtime"):
        self.election_id = election_id
        self.data_dir = Path(data_dir)
        self.data_dir.mkdir(parents=True, exist_ok=True)
    
    def submit_question(self, question_data: Dict) -> str:
        """L√§het√§ uusi kysymys j√§rjestelm√§√§n"""
        tmp_file = self.data_dir / "tmp_new_questions.json"
        
        # Lue nykyinen data tai alusta uusi
        if tmp_file.exists():
            data = read_json_file(str(tmp_file))
        else:
            data = {"questions": [], "metadata": {"election_id": self.election_id}}
        
        # Lis√§√§ uusi kysymys
        question_id = f"q_{len(data['questions']) + 1}"
        question_data["local_id"] = question_id
        data["questions"].append(question_data)
        
        # Tallenna
        write_json_file(str(tmp_file), data)
        return question_id
    
    def sync_tmp_to_new(self) -> List[str]:
        """Synkronoi tmp kysymykset new_questions.json:√§√§n"""
        tmp_file = self.data_dir / "tmp_new_questions.json"
        new_file = self.data_dir / "new_questions.json"
        
        if not tmp_file.exists():
            return []
        
        tmp_data = read_json_file(str(tmp_file))
        new_data = read_json_file(str(new_file)) if new_file.exists() else {"questions": []}
        
        # Siirr√§ kysymykset
        synced_questions = []
        for question in tmp_data["questions"]:
            new_data["questions"].append(question)
            synced_questions.append(question["local_id"])
        
        # Tallenna ja tyhjenn√§ tmp
        write_json_file(str(new_file), new_data)
        write_json_file(str(tmp_file), {"questions": []})
        
        return synced_questions
```

## src/managers/init.py
```python
"""
Manager modules for different system components
"""
```

## src/managers/__init__.py
```python
```

## src/managers/divine_manager.py
```python
"""
Erikoistoiminnallisuus Jumaltenvaaleille
"""
from typing import List, Dict

class DivineManager:
    def __init__(self, election_id: str):
        self.election_id = election_id
        self.divine_domains = [
            "sky_thunder", "sea_earthquakes", "wisdom_warfare", 
            "love_beauty", "war_strategy", "hunting_nature"
        ]
    
    def validate_divine_candidate(self, candidate_data: Dict) -> bool:
        """Varmista ett√§ ehdokas on kelvollinen jumala"""
        required_fields = ["domain", "symbol", "divine_power_level"]
        
        for field in required_fields:
            if field not in candidate_data:
                return False
        
        if candidate_data["domain"] not in self.divine_domains:
            return False
            
        return True
    
    def get_olympian_quorum(self) -> int:
        """Laske tarvittava Olympos-kvoorumi"""
        return 12  # Perinteinen Olympolaisten lukum√§√§r√§
```

## src/core/file_utils.py
```python
import json
from pathlib import Path

def read_json_file(file_path):
    """Lue JSON-tiedosto"""
    with open(file_path, 'r', encoding='utf-8') as f:
        return json.load(f)

def write_json_file(file_path, data):
    """Kirjoita JSON-tiedosto"""
    Path(file_path).parent.mkdir(parents=True, exist_ok=True)
    with open(file_path, 'w', encoding='utf-8') as f:
        json.dump(data, f, indent=2, ensure_ascii=False)
```

## src/core/init.py
```python
"""
Core utilities for decentralized candidate matcher
"""
from .file_utils import read_json_file, write_json_file, calculate_fingerprint
from .ipfs_client import IPFSClient
from .config_manager import ConfigManager

__all__ = [
    'read_json_file', 
    'write_json_file', 
    'calculate_fingerprint',
    'IPFSClient',
    'ConfigManager'
]
```

## src/core/__init__.py
```python
```

## src/core/ipfs_client.py
```python
import ipfshttpclient
from typing import Optional

class MockIPFSClient:
    """Mock IPFS client for testing"""
    def add_json(self, data):
        return {'Hash': f'mock_cid_{hash(str(data))}'}
    
    def get_json(self, cid):
        return {'mock': 'data'}

class IPFSClient:
    _instance: Optional['IPFSClient'] = None
    
    def __init__(self):
        self._client = None
        self._connect()
    
    def _connect(self):
        """Yhdist√§ IPFS:√§√§n tai k√§yt√§ mockia"""
        try:
            self._client = ipfshttpclient.connect()
        except Exception:
            self._client = MockIPFSClient()
    
    @classmethod
    def get_client(cls) -> 'IPFSClient':
        if cls._instance is None:
            cls._instance = IPFSClient()
        return cls._instance
    
    def add_data(self, data: dict) -> str:
        """Lis√§√§ data IPFS:√§√§n ja palauta CID"""
        result = self._client.add_json(data)
        return result['Hash']
    
    def get_data(self, cid: str) -> dict:
        """Hae data IPFS:st√§ CID:ll√§"""
        return self._client.get_json(cid)
```

## src/core/config_manager.py
```python
```

## src/cli/manage_candidates.py
```python
#!/usr/bin/env python3
import click
import json
from datetime import datetime
import os

@click.command()
@click.option('--election', required=True, help='Vaalin tunniste')
@click.option('--add', is_flag=True, help='Lis√§√§ uusi ehdokas')
@click.option('--name', help='Ehdokkaan nimi')
@click.option('--party', help='Puolue')
def manage_candidates(election, add, name, party):
    """Hallinnoi vaaliehdokkaita"""
    
    if add:
        if not name:
            click.echo("‚ùå Anna --name")
            return
        
        # Lataa nykyiset ehdokkaat
        candidates_file = f"data/runtime/candidates.json"
        if os.path.exists(candidates_file):
            with open(candidates_file, 'r') as f:
                data = json.load(f)
        else:
            data = {"candidates": [], "metadata": {"election_id": election}}
        
        # Lis√§√§ uusi ehdokas
        new_candidate = {
            "candidate_id": f"cand_{len(data['candidates']) + 1}",
            "basic_info": {
                "name": {
                    "fi": name,
                    "en": f"[EN] {name}",
                    "sv": f"[SV] {name}"
                },
                "party": party or "sitoutumaton",
                "domain": "divine_power"  # Jumaltenvaalien erikoisala
            },
            "answers": []
        }
        
        data["candidates"].append(new_candidate)
        
        # Tallenna
        with open(candidates_file, 'w') as f:
            json.dump(data, f, indent=2)
        
        click.echo(f"‚úÖ Ehdokas lis√§tty: {name}")
        click.echo(f"üëë Ehdokkaita yhteens√§: {len(data['candidates'])}")

if __name__ == '__main__':
    manage_candidates()
```

## src/cli/__init__.py
```python
```

## src/cli/manage_questions.py
```python
#!/usr/bin/env python3
import click
import json
from datetime import datetime
import os

@click.command()
@click.option('--election', required=True, help='Vaalin tunniste')
@click.option('--add', is_flag=True, help='Lis√§√§ uusi kysymys')
@click.option('--category', help='Kysymyksen kategoria')
@click.option('--question-fi', help='Kysymys suomeksi')
def manage_questions(election, add, category, question_fi):
    """Hallinnoi vaalikoneen kysymyksi√§"""
    
    if add:
        if not category or not question_fi:
            click.echo("‚ùå Anna --category ja --question-fi")
            return
        
        # Lataa nykyiset kysymykset
        questions_file = f"data/runtime/questions.json"
        if os.path.exists(questions_file):
            with open(questions_file, 'r') as f:
                data = json.load(f)
        else:
            data = {"questions": [], "metadata": {"election_id": election}}
        
        # Lis√§√§ uusi kysymys
        new_question = {
            "local_id": f"q_{len(data['questions']) + 1}",
            "content": {
                "category": category,
                "question": {
                    "fi": question_fi,
                    "en": f"[EN] {question_fi}",
                    "sv": f"[SV] {question_fi}"
                },
                "scale": {"min": -5, "max": 5}
            },
            "elo_rating": {
                "base_rating": 1000,
                "current_rating": 1000,
                "comparison_delta": 0,
                "vote_delta": 0
            },
            "timestamps": {
                "created_local": datetime.now().isoformat()
            }
        }
        
        data["questions"].append(new_question)
        
        # Tallenna
        with open(questions_file, 'w') as f:
            json.dump(data, f, indent=2)
        
        click.echo(f"‚úÖ Kysymys lis√§tty: {question_fi}")
        click.echo(f"üìä Kysymyksi√§ yhteens√§: {len(data['questions'])}")

if __name__ == '__main__':
    manage_questions()
```

## src/cli/install.py
```python
#!/usr/bin/env python3
import click
import json
from datetime import datetime
import os

@click.command()
@click.option('--election-id', required=True, help='Vaalin tunniste')
@click.option('--first-install', is_flag=True, help='Ensimm√§inen asennus')
def install_system(election_id, first_install):
    """Asenna vaalij√§rjestelm√§"""
    click.echo(f"üèõÔ∏è Asennetaan Jumaltenvaalit: {election_id}")
    
    # Luo data-hakemisto
    os.makedirs("data/runtime", exist_ok=True)
    
    # Luo system_chain.json
    system_chain = {
        "chain_id": f"system_chain_{election_id}",
        "created_at": datetime.now().isoformat(),
        "description": f"Jumaltenvaalit 2026 - {election_id}",
        "version": "2.0.0",
        "blocks": [
            {
                "block_id": 0,
                "timestamp": datetime.now().isoformat(),
                "action_type": "divine_installation",
                "description": f"Jumaltenvaalit asennettu: {election_id}",
                "user_id": "zeus",
                "previous_hash": None,
                "block_hash": "initial_olympus_hash"
            }
        ]
    }
    
    with open("data/runtime/system_chain.json", "w") as f:
        json.dump(system_chain, f, indent=2)
    
    # Luo meta.json
    meta_data = {
        "metadata": {
            "version": "2.0.0", 
            "created": datetime.now().isoformat(),
            "election_id": election_id,
            "node_id": "olympus_master",
            "system_locked": False,
            "mode": "development",
            "divine_council": True
        }
    }
    
    with open("data/runtime/meta.json", "w") as f:
        json.dump(meta_data, f, indent=2)
    
    click.echo("‚úÖ Jumaltenvaalit asennettu onnistuneesti!")
    click.echo("‚ö° Olympos on valmis vaaleille!")

if __name__ == '__main__':
    install_system()
```

