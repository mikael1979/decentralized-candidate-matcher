<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decentralized Candidate Matcher</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="app">
        <header>
            <h1>üó≥Ô∏è Decentralized Candidate Matcher</h1>
            <nav>
                <button onclick="showView('compare')">Compare Questions</button>
                <button onclick="showView('submit')">Create New Question</button>
                <button onclick="showView('browse')">Browse Questions</button>
                <button onclick="startCandidateComparison()">Match with Candidates</button>
                <button onclick="showView('stats')">Statistics</button>
                <button onclick="exportData()">Export JSON</button>
                <button onclick="importData()">Import JSON</button>
            </nav>
        </header>

        <main>
            <!-- Comparison View -->
            <div id="compare-view" class="view active">
                <h2>Compare Questions</h2>
                <div id="comparison-container" class="comparison-container">
                    <div class="question-card" id="question-a">
                        <h3>Question A</h3>
                        <p id="question-a-text"></p>
                        <button onclick="vote('a')">Choose this</button>
                    </div>
                    
                    <div class="vs">VS</div>
                    
                    <div class="question-card" id="question-b">
                        <h3>Question B</h3>
                        <p id="question-b-text"></p>
                        <button onclick="vote('b')">Choose this</button>
                    </div>
                </div>
                <div class="progress">
                    <span id="progress-text">0/10 comparisons done</span>
                    <progress id="progress-bar" value="0" max="10"></progress>
                </div>
            </div>

            <!-- Question Creation View -->
            <div id="submit-view" class="view">
                <h2>Create New Question</h2>
                <form id="question-form">
                    <textarea 
                        id="question-input" 
                        placeholder="Write your question here..." 
                        required
                    ></textarea>
                    
                    <div class="tag-section">
                        <h4>Add Tags:</h4>
                        <div id="tag-suggestions" class="tag-suggestions"></div>
                        <input 
                            type="text" 
                            id="tag-input" 
                            placeholder="Add new tag..."
                        >
                        <button type="button" onclick="addCustomTag()">Add Tag</button>
                    </div>

                    <div id="duplicate-warning" class="warning hidden">
                        <h4>‚ö†Ô∏è Similar question found:</h4>
                        <div id="duplicate-list"></div>
                    </div>

                    <button type="submit">Create Question</button>
                </form>
            </div>

            <!-- Browse View -->
            <div id="browse-view" class="view">
                <h2>All Questions</h2>
                <input 
                    type="text" 
                    id="search-input" 
                    placeholder="Search questions..."
                    oninput="searchQuestions(this.value)"
                >
                <div id="questions-list" class="questions-list"></div>
            </div>

            <!-- Statistics View -->
            <div id="stats-view" class="view">
                <h2>System Statistics</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Questions</h3>
                        <span id="total-questions">0</span>
                    </div>
                    <div class="stat-card">
                        <h3>Tags</h3>
                        <span id="total-tags">0</span>
                    </div>
                    <div class="stat-card">
                        <h3>Comparisons</h3>
                        <span id="total-comparisons">0</span>
                    </div>
                    <div class="stat-card">
                        <h3>Users</h3>
                        <span id="total-users">1</span>
                    </div>
                </div>
                
                <h3>Popular Tags</h3>
                <div id="popular-tags" class="tags-container"></div>
                
                <h3>Top Questions</h3>
                <div id="top-questions" class="questions-list"></div>
            </div>

            <!-- Candidate Questions View -->
            <div id="candidate-questions-view" class="view">
                <h2>Answer Questions</h2>
                <div id="candidate-question-container"></div>
            </div>

            <!-- Compatibility Results View -->
            <div id="compatibility-results-view" class="view">
                <h2>Compatibility Results</h2>
                <div id="compatibility-results-container"></div>
            </div>

            <!-- Candidate Details View (ONLY ONE INSTANCE) -->
            <div id="candidate-details-view" class="view">
                <div class="candidate-details-header">
                    <button onclick="showView('compatibility-results')" class="back-button">‚Üê Back to Results</button>
                    <h2>Candidate Details</h2>
                </div>
                <div id="candidate-details-container" class="candidate-details-container"></div>
            </div>
        </main>
    </div>

    <!-- Load modules in CORRECT ORDER -->
    <script src="js/question-manager.js"></script>
    <script src="js/tag-system.js"></script>
    <script src="js/duplicate-detector.js"></script>
    <script src="js/rating-system.js"></script>
    <script src="js/candidate-manager.js"></script>
    <script src="js/compatibility-calculator.js"></script>
    <script src="js/app.js"></script>

<script>
// Quick fix for vote function
function vote(winner) {
    if (window.app && window.app.initialized) {
        window.app.vote(winner);
    } else {
        console.warn('App not initialized yet');
    }
}

// Quick fix for showView function
function showView(viewName) {
    if (window.app && window.app.initialized) {
        window.app.showView(viewName);
    } else {
        console.warn('App not initialized yet');
        // Fallback: reload page to initialize app
        setTimeout(() => {
            if (window.app && window.app.initialized) {
                window.app.showView(viewName);
            }
        }, 1000);
    }
}

// Global functions for navigation
function startCandidateComparison() {
    if (window.app && window.app.initialized) {
        window.app.startCandidateComparison();
    } else {
        console.warn('App not initialized yet');
    }
}

function showCandidateDetails(candidateId) {
    if (window.app && window.app.initialized) {
        window.app.showCandidateDetails(candidateId);
    } else {
        console.warn('App not initialized yet');
    }
}

// Global functions for JSON operations
async function exportData() {
    try {
        const data = await window.questionManager.exportToJSON();
        alert('Data exported successfully to JSON format');
    } catch (error) {
        console.error('Export failed:', error);
        alert('Export failed: ' + error.message);
    }
}

function importData() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    
    input.onchange = async (e) => {
        const file = e.target.files[0];
        if (!file) return;
        
        try {
            const text = await file.text();
            const count = await window.questionManager.importFromJSON(text);
            alert(`Import successful! Imported ${count} questions.`);
            if (window.app && window.app.initialized) {
                window.app.loadAllQuestions(); // Update view
            }
        } catch (error) {
            console.error('Import failed:', error);
            alert('Import failed: ' + error.message);
        }
    };
    
    input.click();
}

// Tag functions
function addCustomTag() {
    const input = document.getElementById('tag-input');
    const tagName = input.value.trim();
    
    if (tagName) {
        const container = document.getElementById('tag-suggestions');
        const newTag = document.createElement('span');
        newTag.className = 'tag';
        newTag.textContent = tagName;
        newTag.onclick = () => newTag.classList.toggle('selected');
        container.appendChild(newTag);
        input.value = '';
    }
}

function searchQuestions(query) {
    if (window.app && window.app.initialized) {
        console.log('Search:', query);
        window.app.loadAllQuestions();
    }
}
</script>
</body>
</html>
