# ğŸ“‹ PitkÃ¤t tiedostot ja bugit

## ğŸ“Š PitkÃ¤t tiedostot (yli 300 riviÃ¤)

### ğŸš¨ ErittÃ¤in pitkÃ¤t (>500 riviÃ¤)
1. **`src/templates/html_generator.py`** - ~600 riviÃ¤
   - SisÃ¤ltÃ¤Ã¤ HTML-generoinnin, IPFS-julkaisun, CSS-tyylit, metadata-hallinnan
   - **Jakoehdotus**: 
     - `html_templates.py` - HTML-pohjat
     - `profile_manager.py` - Profiilien hallinta
     - `ipfs_publisher.py` - IPFS-julkaisu

2. **`src/cli/manage_parties.py`** - ~400 riviÃ¤
   - SisÃ¤ltÃ¤Ã¤ kaikki puoluehallinnan komennot
   - **Jakoehdotus**:
     - `party_commands.py` - Peruskomentot
     - `party_verification.py` - Vahvistuslogiikka
     - `party_analytics.py` - Tilastot ja raportit

### ğŸ“ PitkÃ¤t (300-500 riviÃ¤)
3. **`src/cli/manage_answers.py`** - ~350 riviÃ¤
   - Vastausten hallinta kaikilla komennoilla
   - **Jakoehdotus**:
     - `answer_commands.py` - Peruskomentot
     - `answer_validation.py` - Validointi
     - `answer_reports.py` - Raportointi

4. **`src/core/ipfs_client.py`** - ~300 riviÃ¤
   - IPFS-integrointi mock- ja real-toteutuksilla
   - **Jakoehdotus**:
     - `ipfs_base.py` - Perusrajapinta
     - `ipfs_real.py` - Oikea IPFS-client
     - `ipfs_mock.py` - Mock-client

## ğŸ› LÃ¶ydetyt bugit

### ğŸ”´ Kriittiset bugit

1. **Import-ongelma `ipfs_sync_manager.py`:**
```python
# LINJA 12: Virheellinen import
from core.ipfs_client import IPFSClient  # âŒ Ei toimi
# PitÃ¤isi olla:
from src.core.ipfs_client import IPFSClient  # âœ…
```

2. **Hakemiston luonti puuttuu:**
```python
# src/cli/manage_parties.py - LINJA ~180
with open(parties_file, 'w', encoding='utf-8') as f:
    json.dump(data, f, indent=2, ensure_ascii=False)
# âŒ Hakemistoa data/runtime/ ei vÃ¤lttÃ¤mÃ¤ttÃ¤ ole
```

3. **Kysymyksen olemassaolon tarkistus puuttuu:**
```python
# src/cli/manage_answers.py - LINJA ~80
# LisÃ¤Ã¤ vastaus, mutta ei tarkista onko kysymys olemassa
question = next((q for q in questions_data["questions"] if q["local_id"] == question_id), None)
if not question:
    click.echo(f"âŒ KysymystÃ¤ '{question_id}' ei lÃ¶ydy")
    return  # âœ… TÃ¤mÃ¤ on olemassa, mutta...
# âŒ Ei tarkisteta onko vastaus jo olemassa samalle kysymykselle
```

4. **JSON encoding puuttuu:**
```python
# Useissa tiedostoissa, esim. src/cli/manage_candidates.py - LINJA ~30
with open(candidates_file, 'r') as f:  # âŒ Puuttuu encoding
    data = json.load(f)
# PitÃ¤isi olla:
with open(candidates_file, 'r', encoding='utf-8') as f:  # âœ…
```

### ğŸŸ¡ Vakavat bugit

5. **Tiedostopolkujen kovakoodaus:**
```python
# src/managers/elo_manager.py - LINJA 13
with open("data/runtime/questions.json", "r", encoding='utf-8') as f:
# âŒ Oletetaan ettÃ¤ suoritetaan projektin juuresta
```

6. **VirheenkÃ¤sittely puuttuu:**
```python
# src/cli/compare_questions.py - LINJA ~70
result = elo_manager.update_ratings(q1["local_id"], q2["local_id"], user_choice)
# âŒ Ei kÃ¤sitellÃ¤ poikkeuksia jos ELO-pÃ¤ivitys epÃ¤onnistuu
```

7. **Data-validointi puuttuu:**
```python
# src/cli/link_candidate_to_party.py - LINJA ~40
# Tarkistetaan ettÃ¤ puolue on olemassa, mutta...
# âŒ Ei tarkisteta ettÃ¤ ehdokas on olemassa ennen linkitystÃ¤
```

8. **Toistuva koodi:**
```python
# Useissa CLI-tiedostoissa sama tiedostonluku/kirjoituslogiikka
# Esim. src/cli/manage_questions.py, manage_candidates.py, jne.
```

### ğŸ”µ Kevyet bugit

9. **IPFS mock-tilan tiedotus:**
```python
# src/core/ipfs_client.py - LINJA ~40
self._client = MockIPFSClient()
print(f"ğŸ”¶ Mock IPFS-client kÃ¤ytÃ¶ssÃ¤ vaalille: {election_id}")
# âœ… TÃ¤mÃ¤ on hyvÃ¤, mutta...
# âŒ Ei kerrota selkeÃ¤sti mitkÃ¤ toiminnot eivÃ¤t toimi mock-tilassa
```

10. **KÃ¤yttÃ¤jÃ¤n syÃ¶tteen validointi:**
```python
# src/cli/enhanced_party_verification.py - Useita kohtia
# âŒ Ei validoida tarpeeksi tarkasti sÃ¤hkÃ¶postiosoitteita, URL-osoitteita, jne.
```

## ğŸ› ï¸ Korjausehdotukset

### 1. **Luo yhteiset apufunktiot**
```python
# src/core/file_utils.py
import json
from pathlib import Path

def read_json_file(file_path: str) -> dict:
    """Turvallinen JSON-tiedoston lukeminen"""
    path = Path(file_path)
    path.parent.mkdir(parents=True, exist_ok=True)
    with open(path, 'r', encoding='utf-8') as f:
        return json.load(f)

def write_json_file(file_path: str, data: dict):
    """Turvallinen JSON-tiedoston kirjoitus"""
    path = Path(file_path)
    path.parent.mkdir(parents=True, exist_ok=True)
    with open(path, 'w', encoding='utf-8') as f:
        json.dump(data, f, indent=2, ensure_ascii=False)
```

### 2. **Korjaa import-ongelmat**
```python
# Kaikissa manager-tiedostoissa
try:
    from src.core.ipfs_client import IPFSClient
except ImportError:
    # Fallback kehitystilaan
    from core.ipfs_client import IPFSClient
```

### 3. **Paranna validointia**
```python
# src/core/validators.py
class DataValidator:
    @staticmethod
    def validate_candidate_exists(candidate_id: str) -> bool:
        # Toteutus
        
    @staticmethod  
    def validate_question_exists(question_id: str) -> bool:
        # Toteutus
        
    @staticmethod
    def validate_party_exists(party_id: str) -> bool:
        # Toteutus
```

### 4. **Yksinkertaista HTML-generaattoria**
```python
# Jakaminen kolmeen tiedostoon:
# - html_templates.py: HTML-pohjat ja CSS
# - profile_manager.py: Profiilien luonti ja hallinta  
# - ipfs_publisher.py: IPFS-julkaisu ja metadata
```

## ğŸ“ˆ Priorisoidut toimenpiteet

### ğŸ¥‡ PRIORITEETTI 1 (Kriittiset)
1. Korjaa import-ongelmat `ipfs_sync_manager.py`
2. LisÃ¤Ã¤ hakemiston luonti kaikkiin tiedostoonkirjoituksiin
3. Korjaa encoding-ongelmat JSON-tiedostoissa

### ğŸ¥ˆ PRIORITEETTI 2 (TÃ¤rkeÃ¤t)  
4. Paranna data-validointia (kysymykset, ehdokkaat, puolueet)
5. Yhdenmukaista tiedostopolkujen kÃ¤sittely
6. Luo yhteiset apufunktiot tiedostonkÃ¤sittelyyn

### ğŸ¥‰ PRIORITEETTI 3 (HyvÃ¤t)
7. Jaa pitkÃ¤t tiedostot pienempiin moduuleihin
8. Paranna virheenkÃ¤sittelyÃ¤ kaikissa CLI-komennoissa
9. LisÃ¤Ã¤ testaus refaktoroituihin komponentteihin

NÃ¤iden korjausten jÃ¤lkeen koodikanta olisi paljon helpommin yllÃ¤pidettÃ¤vÃ¤ ja vÃ¤hemmÃ¤n altis bugeille! ğŸš€
